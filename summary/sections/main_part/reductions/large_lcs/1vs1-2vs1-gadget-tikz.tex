\newcommand{\lLCSguard}[5]{%
	\node[base, cell, number, guard, minimum width=#4, #5] (#1) at (#2) {#3};
}
\newcommand{\lLCSinput}[5]{%
	\node[base, cell, number, input, minimum width=#4, #5] (#1) at (#2) {#3};
}
\newcommand{\lLCSguardedString}[4]{%
	\lLCSguard{#1_g_0}{base}{$0^{\gamma_1}$}{1.5em}{#4}
	\lLCSguard{#1_g_1_left}{#1_g_0.east}{$1^{\gamma_2}$}{1.5em}{#4}
	\lLCSguard{#1_g_01}{#1_g_1_left.east}{$(01)^{\gamma_3}$}{3em}{#4}
	\lLCSinput{#1}{#1_g_01.east}{#2}{#3}{#4}
	\lLCSguard{#1_g_1_right}{#1.east}{$1^{\gamma_3}$}{1.5em}{#4}
	\coordinate (next) at (#1_g_1_right.east);
}
\newcommand{\lLCSguardedStringTopLabel}[4]{%
	\lLCSguardedString{#1}{$#2$}{#3}{#4}

	% Define the lower-left and lower-right corners
    \coordinate (botLeft) at (#1_g_0.south west);  
    \coordinate (midLeft) at (#1_g_0.north west);  
    \coordinate (botRight) at (#1_g_1_right.south east);
    \coordinate (midRight) at (#1_g_1_right.north east);  
	
	%\node[draw, inner sep=0, minimum height=14pt, anchor=south west, text width=\labelLength] (#1_label) at (southWest) {$G(#2)$};
	\path[draw, #4, fill=none] (botLeft) -- (midLeft) -- ++(0,2.2ex) -| (botRight);
	\node[part label, anchor=south, #4] (#1_label) at ($(midLeft)!0.5!(midRight)$) {$G(#2)$};
}
\newcommand{\lLCSguardedStringBotLabel}[4]{%
	\lLCSguardedString{#1}{$#2$}{#3}{#4}

	% Define the lower-left and lower-right corners
    \coordinate (topLeft) at (#1_g_0.north west); 
    \coordinate (midLeft) at (#1_g_0.south west);   
    \coordinate (topRight) at (#1_g_1_right.north east);
    \coordinate (midRight) at (#1_g_1_right.south east);  
	
	%\node[draw, inner sep=0, minimum height=14pt, anchor=south west, text width=\labelLength] (#1_label) at (southWest) {$G(#2)$};
	\path[draw, #4, fill=none] (topLeft) -- (midLeft) -- ++(0,-2.2ex) -| (topRight);
	\node[part label, anchor=north, #4] (#1_label) at ($(midLeft)!0.5!(midRight)$) {$G(#2)$};
}

\newcommand{\uniqueAlignedMatches}[2]{%
	\path[guard edge] (#1_g_0.north) edge (#2_g_0.south);
	\path[guard edge] (#1_g_1_left.north) edge (#2_g_1_left.south);
	\path[guard edge] (#1_g_01.north) edge (#2_g_01.south);
	\path[guard edge] (#1_g_1_right.north) edge (#2_g_1_right.south);
	
	\path[input edge] (#1.north) edge (#2.south);
	
	\path[input edge, ultra thick, draw] (#1_g_0.south west) -- (#1_g_0.north west) -- (#2_g_0.south west) -- (#2_g_0.north west);
	\path[input edge, ultra thick, draw] (#1_g_1_right.south east) -- (#1_g_1_right.north east) -- (#2_g_1_right.south east) -- (#2_g_1_right.north east);
}

\newcommand{\doubleAlignedMatches}[3]{%
	\path[guard edge] (#1_g_0.north) edge (#2_g_0.south);
	\path[guard edge] (#1_g_1_left.north) edge (#2_g_1_left.south);
	\path[guard edge] (#1_g_01.north) edge (#2_g_01.south);

	\path[input edge] (#1.north) edge (#3_g_01.south);
	
	\path[guard edge] (#1_g_1_right.north) edge (#3_g_1_right.south);
	
}


\begin{figure}
	\centering
	\color{black}
	\begin{tikzpicture}[x=1.5em]
		\tikzstyle{base} = [minimum width=1.5em, inner sep=1pt, anchor=west]
		\tikzstyle{text element} = []
		\tikzstyle{number} = [minimum height=14pt]  
		\tikzstyle{guard} = [fill=gray]  
		\tikzstyle{guard edge} = [color=gray]
		\tikzstyle{big guard} = [fill=gray!75!black]
		\tikzstyle{big guard edge} = [color=gray!75!black]
		\tikzstyle{input} = [fill=cyan]
		\tikzstyle{input edge} = [color=cyan, thick]
		\tikzstyle{cell} = [draw, minimum width=1.5em, fill=white]
		\tikzstyle{part label} = [font=\tiny]
		\tikzstyle{hide} = [draw=white!75!black, text=white!75!black]
		
		\node[base, text element] (eqX) at (0,0) {$=$};
		\node[base, text element, anchor=east] (x) at (eqX.west) {$x$};
		
		\coordinate (base) at ($(eqX.east) + (1,0)$);
		\lLCSguardedStringTopLabel{x1}{x_1}{1.5em}{}
		\coordinate (base) at (next);
		\lLCSguardedStringTopLabel{x2}{x_2}{1.5em}{}
		\coordinate (base) at (next);
		\lLCSguardedStringTopLabel{x3}{x_3}{1.5em}{}
		\coordinate (base) at (next);
		\node[base, minimum width=3em] (x_dots) at (base) {$\cdots$};
		\coordinate (base) at (x_dots.east);
		\lLCSguardedStringTopLabel{xP}{x_P}{1.5em}{}
		
		%\path[draw] (x1_g_1_right.north east) -- (x1_g_1_right.south east);
		%\path[draw] (x2_g_1_right.north east) -- (x2_g_1_right.south east);
		%\path[draw, ultra thick] (x3_g_1_right.north east) -- (x1_g_1_right.south east);
		
		
		
		\node[base, text element] (eqY) at (0,-1.4) {$=$};
		\node[base, text element, anchor=east] (y) at (eqY.west) {$y$};
		
		\coordinate (base) at ($(eqY.east) + (1,0)$);
		\lLCSguardedStringBotLabel{y1}{y_1}{1.5em}{}
		\coordinate (base) at (next);
		\lLCSguardedStringBotLabel{y2}{y_2}{1.5em}{}
		\coordinate (base) at (next);
		\node[base, minimum width=3em] (y_dots) at (base) {$\cdots$};
		\coordinate (base) at (y_dots.east);
		\lLCSguardedStringBotLabel{yQ}{y_Q}{1.5em}{}
		
		\uniqueAlignedMatches{y1}{x1}
		\doubleAlignedMatches{y2}{x2}{x3}
		\uniqueAlignedMatches{yQ}{xP}
	
	\end{tikzpicture}
	\label{fig:1-2vs1gadget}
	\caption{Todo}
\end{figure}

